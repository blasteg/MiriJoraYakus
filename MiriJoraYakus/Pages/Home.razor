@page "/"
@using MiriJoraYakus.Enums
@using MiriJoraYakus.Data
@inject IJSRuntime JsRuntime
<style>
    img.cardGrid {
        max-width: 100%;
        height: auto;
        max-height: 100%;
    }

    img.dimmed {
        filter: brightness(25%)
    }
</style>
<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>
<table>
    <tr>
        @for (int i = 0; i < maxHandSize; i++)
        {
            int n = i;
            <td>
                <img class="cardGrid" src=@("/IdolIcons/"+ (int)(hand.Count>i?hand.ElementAt(n):0)+".png")
                     @onclick="()=>RemoveFromHand(n)" />
            </td>
        }
    </tr>
</table>
Welcome to your new app.
<hr>
<table style=" width:100%">
    @for (int i = 0; i < totalCards / perRow; i++)
    {
        <tr>
            @for (int j = 0; j < perRow; j++)
            {
                int n = i * perRow + j+1;
                if (n < totalCards)
                {
                    <td>
                        <img class="cardGrid @(available[(CardEnum)n]?"normal":"dimmed")" src=@("/IdolIcons/"+(n)+".png")
                             @oncontextmenu="()=>ToggleAvailable(n)" @oncontextmenu:preventDefault="true" @onclick="()=>AddToHand(n)" />
                    </td>
                }
            }
        </tr>
    }
</table>
<table>
@foreach(var a in GlobalDatas.BaseUnitData)
{
    <tr>
        <td>@a?.Name</td>
        @foreach (var b in a?.Idols??new List<CardEnum>())
        {
        <td>@b</td>
        }
    </tr>
}
</table>
@code {
    List<CardEnum> hand = new List<CardEnum>();
    private int maxHandSize = 9;
    private int totalCards = 52;
    private int perRow = 13;
    private Dictionary<CardEnum, bool> available = new Dictionary<CardEnum, bool>();
    protected override async Task OnInitializedAsync()
    {
        foreach (CardEnum a in Enum.GetValues(typeof(CardEnum)))
        {
            available[a] = true;
        }
    }
    private void ToggleAvailable(int n)
    {
        available[(CardEnum)n] = !available[(CardEnum)n];
        StateHasChanged();
    }
    private void AddToHand(int n)
    {
        if (hand.Count >= maxHandSize)
        {
            JsRuntime.InvokeVoidAsync("alert", "Hand is Full");
            return;
        }
        else
        {
            if (available[(CardEnum)n])
            {
                hand.Add((CardEnum)n);
                StateHasChanged();
            }
        }
    }
    private void RemoveFromHand(int n)
    {
        if (hand.Count > n)
            hand.RemoveAt(n);
    }
}